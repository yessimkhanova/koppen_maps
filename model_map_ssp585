var model1 = ee.Image('users/kalamkas/koppen_maps_models/GISS-E2-1-G_koppen_ssp585_2071_2100').select('zone');
var model2 = ee.Image('users/kalamkas/koppen_maps_models/BCC-CSM2-MR_koppen_ssp585_2071_2100').select('zone');
var model3 = ee.Image('users/kalamkas/koppen_maps_models/CESM2_koppen_ssp585_2071_2100').select('zone');
var model4 = ee.Image('users/kalamkas/koppen_maps_models/MIROC-ES2L_koppen_ssp585_2071_2100').select('zone');
var model5 = ee.Image('users/kalamkas/koppen_maps_models/ACCESS-ESM1-5_koppen_ssp585_2071_2100').select('zone');
var model6 = ee.Image('users/kalamkas/koppen_maps_models/CESM2-WACCM_koppen_ssp585_2071_2100').select('zone');
var model7 = ee.Image('users/kalamkas/koppen_maps_models/CMCC-CM2-SR5_koppen_ssp585_2071_2100').select('zone');
var model8 = ee.Image('users/kalamkas/koppen_maps_models/ACCESS-CM2_koppen_ssp585_2071_2100').select('zone');
var model9 = ee.Image('users/kalamkas/koppen_maps_models/CMCC-ESM2_koppen_ssp585_2071_2100').select('zone');
var model10 = ee.Image('users/kalamkas/koppen_maps_models/CNRM-CM6-1_koppen_ssp585_2071_2100').select('zone');
var model11 = ee.Image('users/kalamkas/koppen_maps_models/CanESM5_koppen_ssp585_2071_2100').select('zone');
var model12 = ee.Image('users/kalamkas/koppen_maps_models/EC-Earth3-Veg-LR_koppen_ssp585_2071_2100').select('zone');
var model13 = ee.Image('users/kalamkas/koppen_maps_models/EC-Earth3_koppen_ssp585_2071_2100').select('zone');
var model14 = ee.Image('users/kalamkas/koppen_maps_models/FGOALS-g3_koppen_ssp585_2071_2100').select('zone');
var model15 = ee.Image('users/kalamkas/koppen_maps_models/GFDL-CM4_koppen_ssp585_2071_2100').select('zone');
var model16 = ee.Image('users/kalamkas/koppen_maps_models/GFDL-ESM4_koppen_ssp585_2071_2100').select('zone');
var model17 = ee.Image('users/kalamkas/koppen_maps_models/HadGEM3-GC31-LL_koppen_ssp585_2071_2100').select('zone');
var model18 = ee.Image('users/kalamkas/koppen_maps_models/INM-CM4-8_koppen_ssp585_2071_2100').select('zone');
var model19 = ee.Image('users/kalamkas/koppen_maps_models/INM-CM5-0_koppen_ssp585_2071_2100').select('zone');
var model20 = ee.Image('users/kalamkas/koppen_maps_models/IPSL-CM6A-LR_koppen_ssp585_2071_2100').select('zone');
var model21 = ee.Image('users/kalamkas/koppen_maps_models/KACE-1-0-G_koppen_ssp585_2071_2100').select('zone');
var model22 = ee.Image('users/kalamkas/koppen_maps_models/KIOST-ESM_koppen_ssp585_2071_2100').select('zone');
var model23 = ee.Image('users/kalamkas/koppen_maps_models/MIROC6_koppen_ssp585_2071_2100').select('zone');
var model24 = ee.Image('users/kalamkas/koppen_maps_models/MPI-ESM1-2-HR_koppen_ssp585_2071_2100').select('zone');
var model25 = ee.Image('users/kalamkas/koppen_maps_models/MPI-ESM1-2-LR_koppen_ssp585_2071_2100').select('zone');
var model26 = ee.Image('users/kalamkas/koppen_maps_models/NESM3_koppen_ssp585_2071_2100').select('zone');
var model27 = ee.Image('users/kalamkas/koppen_maps_models/NorESM2-LM_koppen_ssp585_2071_2100').select('zone');
var model28 = ee.Image('users/kalamkas/koppen_maps_models/NorESM2-MM_koppen_ssp585_2071_2100').select('zone');
var model29 = ee.Image('users/kalamkas/koppen_maps_models/TaiESM1_koppen_ssp585_2071_2100').select('zone');
var model30 = ee.Image('users/kalamkas/koppen_maps_models/UKESM1-0-LL_koppen_ssp585_2071_2100').select('zone');
var model31 = ee.Image('users/kalamkas/koppen_maps_models/MRI-ESM2-0_koppen_ssp585_2071_2100').select('zone');
var model32 = ee.Image('users/kalamkas/koppen_maps_models/CNRM-ESM2-1_koppen_ssp585_2071_2100').select('zone');

var koppenCollection = ee.ImageCollection([
  model1, model2, model3, model4, model5, model6, model7, model8,
  model9, model10, model11, model12, model13, model14, model15, model16, model17, model18,
  model19, model20, model21, model22, model23, model24, model25, model26, model27, model28, model29,
  model30, model31, model32
]);

var modelCount = koppenCollection.size(); 

var modalKoppen = koppenCollection.reduce(ee.Reducer.mode()).rename('modal_zone');

var agreementImages = koppenCollection.map(function(img) {
  return img.eq(modalKoppen).rename('agree');
});

var agreementImage = agreementImages.reduce(ee.Reducer.sum()).rename('agreement');

var agreementNorm = agreementImage.divide(modelCount).rename('agreement_norm');

var confidenceThreshold = 0.75;

var highConfidenceMask = agreementNorm.gte(confidenceThreshold);

var modalHighConfidence = modalKoppen.updateMask(highConfidenceMask);

var colors = [
  "000000", "0000FF", "4169E1", "6495ED", "00BFFF",
  "FF0000", "F08080", "FF8C00", "FFD700", "98FB98",
  "3CB371", "2E8B57", "ADFF2F", "00FF00", "32CD32",
  "FFFF00", "BDB76B", "808000", "7B68EE", "6A5ACD",
  "483D8B", "191970", "00FFFF", "87CEFF", "008080",
  "2F4F4F", "FF00FF", "9400D3", "800080", "D8BFD8",
  "A9A9A9", "696969"
];

Map.setCenter(65, 45, 5);

Map.addLayer(modalKoppen, {
  min: 0,
  max: 31,
  palette: colors
}, 'Modal Köppen Class');

Map.addLayer(agreementImage, {
  min: 0,
  max: modelCount.getInfo(),
  palette: ['white', 'gray', 'black']
}, 'Agreement (Number of models - Count)');

Map.addLayer(agreementNorm, {
  min: 0,
  max: 1,
  palette: ['white', 'yellow', 'green']
}, 'Agreement (% Normalized)');

Map.addLayer(modalHighConfidence, {
  min: 0,
  max: 31,
  palette: colors
}, 'Modal Köppen (High Confidence Only, 75 Percent)');